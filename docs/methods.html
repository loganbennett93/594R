<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 4 Methods | A Minimal Book Example</title>
  <meta name="description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 4 Methods | A Minimal Book Example" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 4 Methods | A Minimal Book Example" />
  
  <meta name="twitter:description" content="This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="Yihui Xie" />


<meta name="date" content="2020-11-02" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="literature.html"/>
<link rel="next" href="applications.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Prerequisites</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="literature.html"><a href="literature.html"><i class="fa fa-check"></i><b>3</b> Literature</a></li>
<li class="chapter" data-level="4" data-path="methods.html"><a href="methods.html"><i class="fa fa-check"></i><b>4</b> 4 Methods</a><ul>
<li class="chapter" data-level="4.1" data-path="methods.html"><a href="methods.html#data"><i class="fa fa-check"></i><b>4.1</b> 4.1 Data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="applications.html"><a href="applications.html"><i class="fa fa-check"></i><b>5</b> Applications</a><ul>
<li class="chapter" data-level="5.1" data-path="applications.html"><a href="applications.html#example-one"><i class="fa fa-check"></i><b>5.1</b> Example one</a></li>
<li class="chapter" data-level="5.2" data-path="applications.html"><a href="applications.html#example-two"><i class="fa fa-check"></i><b>5.2</b> Example two</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="final-words.html"><a href="final-words.html"><i class="fa fa-check"></i><b>6</b> Final Words</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Minimal Book Example</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="methods" class="section level1">
<h1><span class="header-section-number">Chapter 4</span> 4 Methods</h1>
<p>We modified a dataset provided by Utah Transit Authority (UTA) to verify the affects of several TSP strategies on headway variation of the UVX BRT system. This BRT system is a 10 mile line between Provo and Orem and was open for public use as of January 9, 2019. The demographics of this area are particularly marked by the presence of two large universities in the area, Brigham Young University in Provo and Utah Valley University in Orem. With over 30,000 students in enrolled in each respective institution each year, a great deal of traffic demand is created between students traveling to and from school, especially considering the fact that housing and job demands are driven by students. For this reason there is a decent amount of UVU students who live in Provo, and the need to make the Provo-Orem commute causes considerable delay during peak hours. In conjunction with servicing other demographics of the population, servicing student needs was a large factor in the decision to implement a BRT system in this area.</p>
<div id="data" class="section level2">
<h2><span class="header-section-number">4.1</span> 4.1 Data</h2>
<p>We created an analysis dataset from UTAâ€™s raw dataset that included timepoint data for all UVX BRT trips from January 2, 2019 to December 30, 2019. The dataset was cleaned and reoriented to reflect data that would be useful in analyzing the distribution of headways over different times of day, locations, and TSP thresholds. We retained within the dataset routes, trips, stops, and vehicles. We simplified the format of these datapoints and created a new variable to hold information regarding reliability, or the difference between scheduled departures and actual departures. we also changed the level descriptions of the TSP thresholds.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="methods.html#cb2-1"></a>(df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb2-2"><a href="methods.html#cb2-2"></a><span class="st">  </span><span class="kw">transmute</span>(</span>
<span id="cb2-3"><a href="methods.html#cb2-3"></a>    <span class="co"># Route and direction IDs</span></span>
<span id="cb2-4"><a href="methods.html#cb2-4"></a>    <span class="dt">route =</span> Route, <span class="dt">direction =</span> <span class="kw">substr</span>(Direction, <span class="dv">0</span>, <span class="dv">2</span>), </span>
<span id="cb2-5"><a href="methods.html#cb2-5"></a>    <span class="dt">trip =</span> Trip,</span>
<span id="cb2-6"><a href="methods.html#cb2-6"></a>    <span class="dt">timepoint =</span> <span class="st">`</span><span class="dt">Time Point</span><span class="st">`</span>,</span>
<span id="cb2-7"><a href="methods.html#cb2-7"></a>    <span class="dt">vehicle =</span> Vehicle,</span>
<span id="cb2-8"><a href="methods.html#cb2-8"></a>    </span>
<span id="cb2-9"><a href="methods.html#cb2-9"></a>    <span class="co"># Time points</span></span>
<span id="cb2-10"><a href="methods.html#cb2-10"></a>    <span class="dt">date =</span> <span class="kw">as_date</span>(NEW_Date),</span>
<span id="cb2-11"><a href="methods.html#cb2-11"></a>    <span class="dt">time =</span> <span class="kw">as_datetime</span>(<span class="kw">str_c</span>(NEW_Date, <span class="st">&quot; &quot;</span>, DepartureTime)),</span>
<span id="cb2-12"><a href="methods.html#cb2-12"></a>    <span class="dt">schedule =</span> <span class="kw">as_datetime</span>(<span class="kw">str_c</span>(NEW_Date, <span class="st">&quot; &quot;</span>, Schedule, <span class="st">&quot;:00&quot;</span>)),</span>
<span id="cb2-13"><a href="methods.html#cb2-13"></a>    <span class="dt">reliability =</span> time <span class="op">-</span><span class="st"> </span>schedule,</span>
<span id="cb2-14"><a href="methods.html#cb2-14"></a>    <span class="dt">dwell =</span> <span class="kw">as.difftime</span>(<span class="kw">str_c</span>(<span class="st">&quot;00:&quot;</span>, Dwell)),</span>
<span id="cb2-15"><a href="methods.html#cb2-15"></a>    <span class="dt">travel =</span> <span class="kw">as.difftime</span>(Travel),</span>
<span id="cb2-16"><a href="methods.html#cb2-16"></a>    </span>
<span id="cb2-17"><a href="methods.html#cb2-17"></a>    <span class="co"># change level descriptions for TSP thresholds</span></span>
<span id="cb2-18"><a href="methods.html#cb2-18"></a>    <span class="dt">threshold =</span> <span class="kw">factor</span>(Threshold, <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">&quot;OFF&quot;</span>, <span class="st">&quot;5&quot;</span>, <span class="st">&quot;2&quot;</span>, <span class="st">&quot;ON&quot;</span>), </span>
<span id="cb2-19"><a href="methods.html#cb2-19"></a>                       <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">&quot;No TSP&quot;</span>, <span class="st">&quot;5 min&quot;</span>, <span class="st">&quot;2 min&quot;</span>, <span class="st">&quot;Always&quot;</span>))</span>
<span id="cb2-20"><a href="methods.html#cb2-20"></a>  ))</span></code></pre></div>
<p>We also calculated elapsed headways, discrepancies between scheduled and actual headways, and cumulative dwell times on trips, as these are potential factors to verify the effects of manipulation on TSP thresholds.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="methods.html#cb3-1"></a>df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb3-2"><a href="methods.html#cb3-2"></a><span class="st">  </span><span class="kw">group_by</span>(direction, timepoint) <span class="op">%&gt;%</span></span>
<span id="cb3-3"><a href="methods.html#cb3-3"></a><span class="st">  </span><span class="kw">arrange</span>(time, <span class="dt">.by_group =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb3-4"><a href="methods.html#cb3-4"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb3-5"><a href="methods.html#cb3-5"></a>    <span class="dt">hw_actl =</span> time <span class="op">-</span><span class="st"> </span><span class="kw">lead</span>(time),</span>
<span id="cb3-6"><a href="methods.html#cb3-6"></a>    <span class="dt">hw_schd =</span> schedule <span class="op">-</span><span class="st"> </span><span class="kw">lead</span>(schedule),</span>
<span id="cb3-7"><a href="methods.html#cb3-7"></a>    <span class="dt">discrepancy =</span> hw_schd <span class="op">-</span><span class="st"> </span>hw_actl</span>
<span id="cb3-8"><a href="methods.html#cb3-8"></a>  )</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="methods.html#cb4-1"></a>df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb4-2"><a href="methods.html#cb4-2"></a><span class="st">  </span><span class="kw">group_by</span>(direction, trip, date) <span class="op">%&gt;%</span></span>
<span id="cb4-3"><a href="methods.html#cb4-3"></a><span class="st">  </span><span class="kw">arrange</span>(time, <span class="dt">.by_group =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></span>
<span id="cb4-4"><a href="methods.html#cb4-4"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb4-5"><a href="methods.html#cb4-5"></a>    <span class="dt">cumdwell =</span> <span class="kw">cumsum</span>(<span class="kw">as.numeric</span>(dwell))</span>
<span id="cb4-6"><a href="methods.html#cb4-6"></a>  )</span></code></pre></div>
<p>The team noticed some data integrity issues, particularly cases where large discrepancies between scheduled and actual headway were taking place. Those outliers can be seen below.</p>
<p><img src="Data/hist-disc.png" width="1050" /></p>
<p>Investigation of these large discrepancies led the team to discover that they tended to occur at certain stops along the route, particularly at the Provo Frontrunner station, as well as at times early in the morning and late at night.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="methods.html#cb5-1"></a><span class="co"># find places where the discrepancy is large</span></span>
<span id="cb5-2"><a href="methods.html#cb5-2"></a>(large_discrepancy &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb5-3"><a href="methods.html#cb5-3"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="op">-</span><span class="kw">abs</span>(discrepancy)) <span class="op">%&gt;%</span></span>
<span id="cb5-4"><a href="methods.html#cb5-4"></a><span class="st">  </span><span class="kw">filter</span>(<span class="kw">abs</span>(discrepancy) <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1000</span>) <span class="op">%&gt;%</span></span>
<span id="cb5-5"><a href="methods.html#cb5-5"></a><span class="st">  </span><span class="kw">select</span>(direction, trip, timepoint, time, discrepancy))</span>
<span id="cb5-6"><a href="methods.html#cb5-6"></a></span>
<span id="cb5-7"><a href="methods.html#cb5-7"></a>large_discrepancy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-8"><a href="methods.html#cb5-8"></a><span class="st">  </span><span class="kw">group_by</span>(timepoint) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-9"><a href="methods.html#cb5-9"></a><span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span>n)</span>
<span id="cb5-10"><a href="methods.html#cb5-10"></a></span>
<span id="cb5-11"><a href="methods.html#cb5-11"></a>large_discrepancy <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-12"><a href="methods.html#cb5-12"></a><span class="st">  </span><span class="kw">group_by</span>(trip) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-13"><a href="methods.html#cb5-13"></a><span class="st">  </span><span class="kw">tally</span>() <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">arrange</span>(<span class="op">-</span>n)</span></code></pre></div>
<p>The distribution of discrepancies was shown to improve in normalcy with the omission of headways occurring before 7 PM and after 8 PM. Southbound trips at both the Provo Frontrunner 1 and Provo Frontrunner 2 stops were also omitted since the buses stop twice at the same location in the same direction.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="methods.html#cb6-1"></a>study_df &lt;-<span class="st"> </span>df <span class="op">%&gt;%</span></span>
<span id="cb6-2"><a href="methods.html#cb6-2"></a><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span></span>
<span id="cb6-3"><a href="methods.html#cb6-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb6-4"><a href="methods.html#cb6-4"></a>    <span class="dt">hour =</span> lubridate<span class="op">::</span><span class="kw">hour</span>(time),</span>
<span id="cb6-5"><a href="methods.html#cb6-5"></a>    <span class="dt">weekday =</span> lubridate<span class="op">::</span><span class="kw">wday</span>(time)</span>
<span id="cb6-6"><a href="methods.html#cb6-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb6-7"><a href="methods.html#cb6-7"></a><span class="st">  </span><span class="kw">filter</span>(</span>
<span id="cb6-8"><a href="methods.html#cb6-8"></a>    <span class="op">!</span>weekday <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Sunday&quot;</span>),</span>
<span id="cb6-9"><a href="methods.html#cb6-9"></a>    hour <span class="op">&gt;=</span><span class="st"> </span><span class="dv">7</span>, hour <span class="op">&lt;=</span><span class="st"> </span><span class="dv">20</span></span>
<span id="cb6-10"><a href="methods.html#cb6-10"></a>  )</span>
<span id="cb6-11"><a href="methods.html#cb6-11"></a></span>
<span id="cb6-12"><a href="methods.html#cb6-12"></a>study_df &lt;-<span class="st"> </span>study_df[<span class="op">!</span>(study_df<span class="op">$</span>timepoint <span class="op">==</span><span class="st"> &quot;PROVFRST - 1&quot;</span> <span class="op">|</span><span class="st"> </span>study_df<span class="op">$</span>timepoint <span class="op">==</span><span class="st"> &quot;PROVFRST - 2&quot;</span>),]</span></code></pre></div>
<p>The cleaned dataset had a better distribution of headway discrepancies, as is seen below.</p>
<p><img src="Data/hist-disc-study.png" width="1094" /></p>
<p>This data is ready for analysis of headways distributions based off of modifications to TSP strategies.</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="literature.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="applications.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["594R.pdf", "594R.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
